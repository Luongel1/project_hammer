---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - First author
  - Another author
thanks: "Code and data are available at: [https://github.com/RohanAlexander/starter_folder](https://github.com/RohanAlexander/starter_folder)."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
library(ggplot2)
library(dplyr)
library(knitr)
```


# Introduction

Overview paragraph

Estimand paragraph

Results paragraph

Why it matters paragraph

Telegraphing paragraph: The remainder of this paper is structured as follows. @sec-data....






# Data {#sec-data}

## Overview

For this study, we utilize data from Project Hammer, a Canadian initiative designed to monitor grocery prices across major retailers in Canada. The Project Hammer dataset was collected from eight prominent Canadian grocery vendors—Voila, T&T, Loblaws, No Frills, Metro, Galleria, Walmart, and Save-On-Foods—between February 28, 2024, and the latest available data load in the database [@citeProjectHammerData]. This dataset enables us to investigate price fluctuations, identify pricing trends, and explore potential competitive or collusive patterns within the Canadian grocery sector.
Project Hammer aims to support regulatory efforts by providing data on price transparency, making it suitable for academic research and potential legal analysis. Following data processing and cleaning procedures outlined in Section 3.2, the dataset was structured to allow an analysis of historical price changes and vendor-specific price patterns.
The dataset contains 1,996,969 rows and 5 columns, with variables capturing product (product name), vendor_name (name of the grocery retailer), price_current (current product price at the time of recording), price_old (previous recorded price for the product), and price_difference (difference between the current and old prices). Price data is recorded in Canadian dollars and captures a broad range of grocery items from various categories, including fresh produce, dairy, pantry staples, and household items.
To ensure the quality and consistency of the data, we focused on removing missing values and imputing outlier prices when necessary. For this analysis, we excluded entries with extreme price fluctuations beyond three standard deviations, as these could represent temporary discounts or data recording anomalies. This cleaning process provides a balanced and accurate reflection of grocery pricing, allowing for robust statistical analysis on vendor-specific trends and average price comparisons across product types.
By narrowing the scope to recent data, Project Hammer's dataset captures real-time fluctuations in grocery pricing, providing timely insights into potential market dynamics and consumer price impacts. The analysis allows for future investigation of temporal price trends, vendor-based price differences, and, more broadly, consumer affordability in a market facing rising cost-of-living pressures.


## Measurement
	
Some paragraphs about how we go from a phenomena in the world to an entry in the dataset.

## Outcome variables

Add graphs, tables and text. Use sub-sub-headings for each outcome variable or update the subheading to be singular.



Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
#| label: fig-bills
#| fig-cap: Bills of penguins
#| echo: false

ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(alpha = 0.8) +
  scale_fill_manual(values = c("darkorange","purple","cyan4"),
                    guide = "none") +
  theme_minimal() +
  facet_wrap(~species, ncol = 1) +
  coord_flip()
```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false

analysis_data <- read_csv(here::here("data/02-analysis_data/analysis_data.csv"))

analysis_data |> 
  ggplot(aes(x = width, y = length)) +
  geom_point(alpha = 0.8) +
  theme_minimal() +
  labs(x = "Wing width (mm)",
       y = "Wing length (mm)")
```

Talk way more about it. 

## Predictor variables

Add graphs, tables and text.

Use sub-sub-headings for each outcome variable and feel free to combine a few into one if they go together naturally.








# Model

Our modeling approach seeks to explore and quantify the relationship between previous grocery prices, vendor identities, and price differences in the current prices observed within Canadian grocery stores. This analysis employs a Bayesian linear regression model implemented via the `stan
_glm` function in the `rstanarm` package to examine how factors such as historical prices, vendor differences, and observed price changes impact current prices for various grocery items.

In this model, `price_current` serves as the response variable, while `price_old`, `vendor_name`, and `price_difference` act as predictor variables. The linear regression model assumes a Gaussian distribution for the response variable `price_current`, allowing for a straightforward interpretation of the estimated parameters.


## Model set-up

The model includes the following predictor variables:

- Previous Price (`price_old`): The price of the product in a previous time period.

- Vendor (`vendor_name`): A categorical variable representing the grocery store chain selling the product, capturing vendor-specific pricing differences.

- Price Difference (`price_difference`): The difference between the current and previous price, which may indicate market or vendor-specific pricing adjustments.

The model can be represented mathematically as follows:

\begin{align*}
    y_i \mid \mu_i, \sigma &\sim \text{Normal}(\mu_i, \sigma) \\
    \mu_i &= \beta_0 + \beta_1 \cdot \text{Previous Price}_i + \beta_2 \cdot \text{Vendor}_i + \beta_3 \cdot \text{Price Difference}_i \\
    \epsilon_i &\sim \text{Normal}(0, \sigma^2)
\end{align*}

\textbf{Where:}
\begin{itemize}
    \item $\beta_0$ is the intercept term, representing the baseline estimage of `price_current`
    \item $\beta_1$, $\beta_2$, and $\beta_3$ are the coefficients representing the effects of `price_old`, `vendor_name` and `price_difference` on `price_current`.
    \item $\sigma^2$represents the variance of the error term, capturing unexplained variability in current prices.
\end{itemize}

The model is executed in \texttt{R} [@citeR] using the \texttt{rstanarm} package [@rstanarm],  with priors set to regularize the estimates and prevent overfitting. Specifically, we use a normal prior for the coefficients, centered at zero with moderate variance, to ensure stable estimates without overly restrictive assumptions.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

The results of our analysis of the Project Hammer dataset explain important findings about pricing trends across major Canadian grocery vendors. By examining factors such as prior pricing (`price_old`), vendor identities (`vendor_name`), and recent price changes (`price_difference`), we assess how these variables affect current prices (`price_current`). The following sections summarize key findings, supported by visualizations that highlight trends and relationships within the data.

## Vendor-Specific Price Trends

We begin by examining average current prices (`price_current`) across different grocery vendors to identify potential pricing variations in the Canadian grocery market.

```{r}
#### Read data ####
# Load the cleaned dataset
analysis_data <- read_csv("C:/Users/eliza/Downloads/hammer-3-compressed/cleaned_price_changes.csv", show_col_types = FALSE)

# Generate plot for Average Current Price by Vendor
vendor_price_plot <- analysis_data %>%
  group_by(vendor_name) %>%
  summarize(avg_price_current = mean(price_current, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(vendor_name, avg_price_current), y = avg_price_current)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  coord_flip() +
  labs(
    title = "Average Current Price by Vendor",
    x = "Vendor",
    y = "Average Current Price (CAD)"
  ) +
  theme_minimal()

# Display the plot
vendor_price_plot

```

Figure 1: Average Current Price by Vendor. This bar plot shows the average price of products sold by each grocery vendor in Canadian dollars (CAD). Variations in pricing suggest differences in market positioning or pricing strategies among vendors, with some retailers consistently offering higher or lower prices across product categories.

## Price Difference Analysis

We further analyze `price_difference`, which captures the change between the current price (`price_current`) and the previous price (`price_old`). This variable provides insights into recent price adjustments across vendors.

```{r}
# Average price difference by vendor
price_diff_plot <- analysis_data %>%
  group_by(vendor_name) %>%
  summarize(avg_price_difference = mean(price_difference, na.rm = TRUE)) %>%
  ggplot(aes(x = reorder(vendor_name, avg_price_difference), y = avg_price_difference)) +
  geom_bar(stat = "identity", fill = "coral") +
  coord_flip() +
  labs(
    title = "Average Price Difference by Vendor",
    x = "Vendor",
    y = "Average Price Difference (CAD)"
  ) +
  theme_minimal()
price_diff_plot

```

Figure 2: Average Price Difference by Vendor. This bar plot shows the average price change per vendor, highlighting retailers with the most significant pricing adjustments. Positive differences suggest recent price increases, while negative differences indicate reductions, reflecting possible discounting or competitive pricing strategies.

## Relationship Between Previous and Current Prices


We assess the relationship between previous prices (`price_old`) and current prices (`price_current`) to understand price consistency and potential price elasticity across products.

```{r}
# Scatter plot of previous price vs. current price
price_relationship_plot <- ggplot(analysis_data, aes(x = price_old, y = price_current)) +
  geom_point(alpha = 0.4, color = "blue") +
  geom_smooth(method = "lm", color = "red") +
  labs(
    title = "Relationship Between Previous and Current Prices",
    x = "Previous Price (CAD)",
    y = "Current Price (CAD)"
  ) +
  theme_minimal()
price_relationship_plot


```
Figure 3: Relationship Between Previous and Current Prices. This scatter plot with a linear regression line shows the correlation between previous and current prices. A positive relationship would indicate that higher previous prices predict higher current prices, implying potential price stability or gradual price changes in the grocery market.

## Distribution of Price Differences

To further explore pricing dynamics, we examine the distribution of `price_difference`, capturing both price increases and decreases across the dataset.

```{r}
# Calculate mean and standard deviation of price_difference
mean_diff <- mean(analysis_data$price_difference, na.rm = TRUE)
sd_diff <- sd(analysis_data$price_difference, na.rm = TRUE)

# Filter out extreme values beyond 3 standard deviations
filtered_data <- analysis_data %>%
  filter(price_difference >= (mean_diff - 3 * sd_diff),
         price_difference <= (mean_diff + 3 * sd_diff))

# Plot histogram with filtered data
price_difference_hist <- ggplot(filtered_data, aes(x = price_difference)) +
  geom_histogram(bins = 30, fill = "lightgreen", color = "black") +
  labs(
    title = "Distribution of Price Differences (Filtered)",
    x = "Price Difference (CAD)",
    y = "Frequency"
  ) +
  theme_minimal()
price_difference_hist

```

Figure 4: Distribution of Price Differences (Filtered). This histogram illustrates the frequency of price changes across products, with extreme values beyond three standard deviations removed for clarity. The concentration around zero suggests that small price adjustments are most common, while the presence of both negative and positive values indicates instances of both price increases and decreases. This distribution provides insight into the stability and variability of pricing across vendors.
## Model Evaluation

To evaluate our model’s performance, we assess the predictive accuracy of the Bayesian linear regression model on the test data. The model’s Mean Absolute Error (MAE) and Root Mean Squared Error (RMSE) provide insights into the model’s ability to predict `price_current` based on `price_old`, `vendor_name`, and `price_difference`.

```{r}
# Calculate MAE and RMSE for model evaluation
mae <- mean(abs(predictions - analysis_data_test$price_current))
rmse <- sqrt(mean((predictions - analysis_data_test$price_current)^2))

evaluation_metrics <- data.frame(
  Metric = c("Mean Absolute Error (MAE)", "Root Mean Squared Error (RMSE)"),
  Value = c(round(mae, 2), round(rmse, 2))
)

# Display the results table
kable(evaluation_metrics, col.names = c("Evaluation Metric", "Value"))

print(evaluation_metrics)

```

Table 1: Model Evaluation Metrics. The table displays the MAE and RMSE for the model, reflecting the average and squared prediction errors, respectively. Lower values indicate better predictive accuracy, suggesting that the model effectively captures the relationship between previous prices, vendor identities, and price differences.

These results demonstrate that vendor identity and previous prices are significant predictors of current prices in the Canadian grocery sector, with implications for understanding competitive strategies and consumer price sensitivity in the market.


# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


